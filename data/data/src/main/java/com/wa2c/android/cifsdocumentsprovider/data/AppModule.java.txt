package com.wa2c.android.cifsdocumentsprovider.data;

import android.content.Context;
import com.wa2c.android.cifsdocumentsprovider.data.db.AppDatabase;
import com.wa2c.android.cifsdocumentsprovider.data.db.ConnectionSettingDao;
import com.wa2c.android.cifsdocumentsprovider.data.preference.AppPreferencesDataStore;
import dagger.Module;
import dagger.Provides;
import dagger.hilt.InstallIn;
import dagger.hilt.android.qualifiers.ApplicationContext;
import dagger.hilt.components.SingletonComponent;

import javax.inject.Singleton;

@Module
@InstallIn(SingletonComponent.class)
public abstract class AppModule {

    /** AppDatabase */
    @Singleton
    @Provides
    public static AppDatabase provideDatabase(
            @ApplicationContext Context context
    ) {
        return AppDatabase.buildDb(context);
    }

    /** StorageSettingDao */
    @Singleton
    @Provides
    public static ConnectionSettingDao provideDao(AppDatabase db) {
        return db.getStorageSettingDao();
    }


    /** DataStore */
    @Singleton
    @Provides
    public static AppPreferencesDataStore providePreferencesDataStore(
            @ApplicationContext Context context
    ) {
        return new AppPreferencesDataStore(context);
    }

    /** StorageClientManager */
    @Singleton
    @Provides
    public static StorageClientManager provideStorageClientManager(
            AppPreferencesDataStore preferences
    ) {
        return new StorageClientManager(preferences.openFileLimitFlow.first());
    }
}

